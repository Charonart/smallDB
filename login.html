<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clothing - Đăng nhập</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <main>
        <div class="auth-container">
            <h2 class="auth-title" id="auth-title">Đăng nhập</h2>
            
            <!-- Login Form -->
            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Mật khẩu:</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="auth-btn">Đăng nhập</button>
            </form>

            <!-- Register Form -->
            <form id="register-form" class="auth-form" style="display: none;">
                <div class="form-group">
                    <label for="reg-name">Họ và tên:</label>
                    <input type="text" id="reg-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="reg-email">Email:</label>
                    <input type="email" id="reg-email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="reg-password">Mật khẩu:</label>
                    <input type="password" id="reg-password" name="password" required>
                </div>
                <div class="form-group">
                    <label for="reg-confirm-password">Xác nhận mật khẩu:</label>
                    <input type="password" id="reg-confirm-password" name="confirm-password" required>
                </div>
                <button type="submit" class="auth-btn">Đăng ký</button>
            </form>

            <div class="toggle-auth">
                <span id="toggle-text">Chưa có tài khoản? </span>
                <a href="#" id="toggle-link">Đăng ký ngay!</a>
            </div>
        </div>
    </main>

    <script src="js/main.js"></script>
    <script>
        // Login/Register toggle functionality
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const authTitle = document.getElementById('auth-title');
        const toggleLink = document.getElementById('toggle-link');
        const toggleText = document.getElementById('toggle-text');

        toggleLink.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (loginForm.style.display === 'none') {
                // Show login form
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                authTitle.textContent = 'Đăng nhập';
                toggleText.textContent = 'Chưa có tài khoản? ';
                toggleLink.textContent = 'Đăng ký ngay!';
            } else {
                // Show register form
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                authTitle.textContent = 'Đăng ký';
                toggleText.textContent = 'Đã có tài khoản? ';
                toggleLink.textContent = 'Đăng nhập ngay!';
            }
        });

        // Login form submission
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            fetch(`https://my-json-server.typicode.com/Charonart/smallDB/users?email=${email}&password=${password}`)
                .then(response => response.json())
                .then(users => {
                    if (users.length > 0) {
                        const user = users[0];
                        localStorage.setItem('currentUser', JSON.stringify(user));
                        alert('Đăng nhập thành công!');
                        
                        if (user.role === 'admin') {
                            window.location.href = 'admin/index.html';
                        } else {
                            window.location.href = 'index.html';
                        }
                    } else {
                        alert('Email hoặc mật khẩu không đúng!');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Có lỗi xảy ra khi đăng nhập!');
                });
        });

        // Register form submission
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;

            if (password !== confirmPassword) {
                alert('Mật khẩu xác nhận không khớp!');
                return;
            }

            // Check if email already exists
            fetch(`https://my-json-server.typicode.com/Charonart/smallDB/users?email=${email}`)
                .then(response => response.json())
                .then(users => {
                    if (users.length > 0) {
                        alert('Email này đã được sử dụng!');
                        return;
                    }

                    // Create new user
                    const newUser = {
                        id: Date.now().toString(),
                        name: name,
                        email: email,
                        password: password,
                        role: 'customer'
                    };

                    // Note: Since we can't actually POST to the JSON server,
                    // we'll just simulate success and store locally
                    localStorage.setItem('currentUser', JSON.stringify(newUser));
                    alert('Đăng ký thành công!');
                    window.location.href = 'index.html';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Có lỗi xảy ra khi đăng ký!');
                });
        });
    </script>
</body>
</html>
